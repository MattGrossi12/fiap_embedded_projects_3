@startuml
title Arquitetura Top-View — ESP32 (Conexões Diretas Harmônicas)

left to right direction
skinparam shadowing false
skinparam backgroundColor white
skinparam packageStyle rectangle
skinparam roundcorner 12
skinparam linetype ortho
hide stereotype

'mais espaço para o roteador não colapsar linhas
skinparam nodesep 70
skinparam ranksep 80

skinparam package {
  BorderColor #666666
  FontStyle bold
}
skinparam rectangleBorderColor #666666

'========================
' Cores por classe
'========================
skinparam component<<IN>> {
  BackgroundColor #D9F2D9
  BorderColor #2E7D32
  FontColor #1B5E20
}
skinparam component<<INOUT>> {
  BackgroundColor #DDEBFF
  BorderColor #1565C0
  FontColor #0D47A1
}
skinparam component<<OUT>> {
  BackgroundColor #FFE2E2
  BorderColor #C62828
  FontColor #8E0000
}
skinparam component<<IHM>> {
  BackgroundColor #FFF2CC
  BorderColor #B8860B
  FontColor #6B4E00
}
skinparam node {
  BackgroundColor #FFFFFF
  BorderColor #222222
  FontColor #111111
}

'========================
' Núcleo
'========================
node "ESP32\n(Cérebro do Sistema)" as ESP32

'========================
' ENTRADAS (empilhadas)
'========================
package "ENTRADAS" as IN {

  package "Instrumentos de campo" as FIELD {
    component "Botão 1" as btn1 <<IN>>
    component "Botão 2" as btn2 <<IN>>
    component "Botão 3" as btn3 <<IN>>
    component "Botão 4" as btn4 <<IN>>
    btn1 -[hidden]-> btn2
    btn2 -[hidden]-> btn3
    btn3 -[hidden]-> btn4
  }

  package "Sensores de Gás" as GAS {
    component "Gás 1" as gas1 <<IN>>
    component "Gás 2" as gas2 <<IN>>
    component "Gás 3" as gas3 <<IN>>
    component "Gás 4" as gas4 <<IN>>
    gas1 -[hidden]-> gas2
    gas2 -[hidden]-> gas3
    gas3 -[hidden]-> gas4
  }

  package "Sensores LDR" as LDR {
    component "LDR 1" as ldr1 <<IN>>
    component "LDR 2" as ldr2 <<IN>>
    component "LDR 3" as ldr3 <<IN>>
    component "LDR 4" as ldr4 <<IN>>
    ldr1 -[hidden]-> ldr2
    ldr2 -[hidden]-> ldr3
    ldr3 -[hidden]-> ldr4
  }

  FIELD -[hidden]-> GAS
  GAS   -[hidden]-> LDR
}

'========================
' SAÍDAS
'========================
package "SAÍDAS" as OUT {
  package "Relés" as RELAYS {
    component "Relé 1" as r1 <<OUT>>
    component "Relé 2" as r2 <<OUT>>
    component "Relé 3" as r3 <<OUT>>
    component "Relé 4" as r4 <<OUT>>
    r1 -[hidden]-> r2
    r2 -[hidden]-> r3
    r3 -[hidden]-> r4
  }
  component "Buzzer" as BUZZER <<OUT>>
  RELAYS -[hidden]-> BUZZER
}

'========================
' COMUNICAÇÃO
'========================
rectangle "COMUNICAÇÃO" as COMMS {
  component "Broker MQTT\n(Comandos ↔ Telemetria)" as MQTT <<INOUT>>
}

'========================
' IHM (ancorada perto do ESP32)
'========================
package "IHM" as UI {
  component "Display ILI9341" as DISP <<IHM>>
}

'========================
' Travas macro (SEM setas direcionais)
'========================
GAS -[hidden]-> ESP32
ESP32 -[hidden]-> OUT
COMMS -[hidden]-> ESP32

'Cola o IHM ao lado do ESP32 e evita que ele “vá pro fundo”
ESP32 -[hidden]-> UI
UI -[hidden]-> OUT

'========================
' Conexões diretas (Entradas -> ESP32)
'========================
btn1 --> ESP32
btn2 --> ESP32
btn3 --> ESP32
btn4 --> ESP32

gas1 --> ESP32
gas2 --> ESP32
gas3 --> ESP32
gas4 --> ESP32

ldr1 --> ESP32
ldr2 --> ESP32
ldr3 --> ESP32
ldr4 --> ESP32

'MQTT bidirecional (sem setas direcionais especiais)
MQTT --> ESP32 : comandos
ESP32 --> MQTT : telemetria

'========================
' Conexões diretas (ESP32 -> Saídas / IHM)
'========================
ESP32 --> r1
ESP32 --> r2
ESP32 --> r3
ESP32 --> r4
ESP32 --> BUZZER : alarme

'Display (agora fica curto porque o bloco UI está ancorado ao ESP32)
ESP32 --> DISP : SPI/GPIO

@enduml